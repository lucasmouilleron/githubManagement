githubManagement
================

TODO
----
- hooks/default.php : building (dc builder simplified, locals files are in a folder on the test server)

Features
--------
- Github projects management and deployment
- Relies on Github user roles and access rights
- Small API to create tags, respond to Githib hooks, etc.
- Hooks : default or project specific hook
- Deployment on tag : when a deoployment tag (tag containing a specific code) is pushed or created via API, the project is deployed to the web folder
- Miscs : loging

Notes
-----
- Not yet compatible with Github entreprise
- Most API calls require a Github user access token : https://github.com/settings/applications#personal-access-tokens
- `GITHUB_MASTER_TOKEN` user must have access to all repos
- Deployment is purposly simple. Other methods could involve branching and pushing tags to specific branches.

Architecture
------------
- `builder` : default project builder
- `hooks/default.php` : default web hook handler
- `hooks/projects` : project specific web hook handlers (hooks must be named `owner__repo.php`)
- `configs` : projects config files
- `locals` : projects locals files
- `repos-clones` : temporary repos clones (clones for building then copying to `web`)
- `api` : the public API
- `web` : web projects exports (ie the test web server root)

API Routes
----------
- Create a tag :
	- `POST /repos/:owner/:repo/tag` :
	- post params : tag-revision, tag-name, tag-message
	- get param : github-token (the github token of the user)
	- example : `Requests::post(API_URL."/repos/lucasmouilleron/testDeploy/tag?github-token=THE_USER_TOKEN", array(), array("tag-revision"=>$revision,"tag-name"=>"tag".time(),"tag-message"=>"message !"))`;
- Init deployments : 
	- `POST /repos/:owner/:repo/hook/init`
	- post params : none
	- get param : github-token (the github token of the user) (use `GITHUB_MASTER_TOKEN` if called from PHP for administration purpose)
	- example : `Requests::post(API_URL."/repos/lucasmouilleron/testDeploy/hook/init?github-token=".GITHUB_MASTER_TOKEN);`
- Github hook : 
	- `POST /repos/:owner/:repo/hook/:token`
	- called by github on tag create
	- `token` is generated by us and is used for security purpose

Install requirements
--------------------
- `curl -sS https://getcomposer.org/installer | php`
- `mv composer.phar /usr/local/bin/composer`

Install
-------
- `cd api && composer install`
- `mv api/config.php.sample api/config.php`
- edit the `api/config.php` file :
	- change `API_PRIVATE_KEY` to a random string
	- `API_URL` is where your api is publicly http available